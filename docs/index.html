<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>clustOpt • clustOpt</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="clustOpt">
<meta name="description" content="Objective optimization of clustering resolution parameters  in single-cell and mass cytometry data
">
<meta property="og:description" content="Objective optimization of clustering resolution parameters  in single-cell and mass cytometry data
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">clustOpt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/quick_start_guide.html">Quick Start Guide</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gladstone-institutes/clustOpt" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="clustopt-">clustOpt <img src="reference/figures/clustOpt_logo.png" align="right" height="138" alt="clustOpt logo"><a class="anchor" aria-label="anchor" href="#clustopt-"></a>
</h1></div>
<!-- badges: start -->

<p><em>Authors: Natalie Gill, Min-Gyoung Shin,Ayushi Agrawal, and Reuben Thomas</em></p>
<p>Selecting the clustering resolution parameter for Louvain clustering in scRNA-seq is often based on the concentration of expression of cell type marker genes within clusters, increasing the parameter as needed to resolve clusters with mixed cell type gene signatures. This approach is however subjective in situations where one does not have complete knowledge of condition/disease associated cell-types in the context of novel biology, it is time-consuming and has the potential to bias the final clustering results due to individual transcriptomic heterogeneity, and subject-specific differences in cell composition.</p>
<p>clustOpt improves the reproducibility of modularity-based clustering in multi-subject experiments by using a combination of subject-wise cross-validation, feature splitting, random forests, and measures of cluster quality using the silhouette metric to guide the selection of the resolution parameter. The package supports both single-cell RNA-seq and CyTOF data with optimized preprocessing pipelines for each data type.</p>
<div class="section level2">
<h2 id="clustopt-algorithm">clustOpt Algorithm<a class="anchor" aria-label="anchor" href="#clustopt-algorithm"></a>
</h2>
<p><img src="reference/figures/clustOpt_diagram.png" align="center" alt="clustOpt algorithm"></p>
<p>To avoid the issue of data leakage we cluster and evaluate in the odd PC space while training and predicting in the even PC space.</p>
<p align="center">
<img src="reference/figures/pc_split.png" width="60%" alt="clustOpt logo"></p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="standard-installation">Standard Installation<a class="anchor" aria-label="anchor" href="#standard-installation"></a>
</h3>
<p>Install the development version from GitHub using <code>devtools</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install devtools if needed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Install clustOpt</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gladstone-institutes/clustOpt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="full-installation-with-optional-dependencies">Full Installation with Optional Dependencies<a class="anchor" aria-label="anchor" href="#full-installation-with-optional-dependencies"></a>
</h3>
<p>For complete functionality including large dataset support:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install core package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gladstone-institutes/clustOpt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install optional dependencies for large datasets</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"BPCells"</span><span class="op">)</span>  <span class="co"># For on-disk matrix operations</span></span>
<span></span>
<span><span class="co"># Verify installation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gladstone-institutes.github.io/clustOpt">clustOpt</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"clustOpt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="troubleshooting-installation">Troubleshooting Installation<a class="anchor" aria-label="anchor" href="#troubleshooting-installation"></a>
</h3>
<p>If you encounter GitHub authentication issues:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up Git configuration</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_git_config.html" class="external-link">use_git_config</a></span><span class="op">(</span>user.name <span class="op">=</span> <span class="st">"YourName"</span>, user.email <span class="op">=</span> <span class="st">"your@email.com"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate GitHub token (opens browser)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/github-token.html" class="external-link">create_github_token</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the token (paste when prompted)</span></span>
<span><span class="fu">credentials</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/credentials/reference/set_github_pat.html" class="external-link">set_github_pat</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Try installation again</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gladstone-institutes/clustOpt"</span><span class="op">)</span></span></code></pre></div>
<p>For permission or dependency issues:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install with dependencies</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gladstone-institutes/clustOpt"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or install system dependencies first on Linux</span></span>
<span><span class="co"># sudo apt-get update</span></span>
<span><span class="co"># sudo apt-get install libcurl4-openssl-dev libssl-dev libxml2-dev</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li>
<strong>Objective resolution selection</strong> using cross-validation and silhouette scores</li>
<li>
<strong>Prevents data leakage</strong> by splitting principal components<br>
</li>
<li>
<strong>Supports scRNA-seq and CyTOF</strong> with optimized preprocessing</li>
<li>
<strong>Scales to large datasets</strong> Automatically reduces the size of large datasets (&gt;200k cells) with Seurat’s leverage score based sketching</li>
</ul>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gladstone-institutes.github.io/clustOpt">clustOpt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic usage for scRNA-seq</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clust_opt.html">clust_opt</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">seurat_obj</span>,</span>
<span>  ndim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  subject_ids <span class="op">=</span> <span class="st">"donor_id"</span>,</span>
<span>  res_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CyTOF data (ndim should equal the number of markers in the panel)</span></span>
<span><span class="va">cytof_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clust_opt.html">clust_opt</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">cytof_seurat</span>,</span>
<span>  ndim <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  dtype <span class="op">=</span> <span class="st">"CyTOF"</span>,</span>
<span>  subject_ids <span class="op">=</span> <span class="st">"donor_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Large datasets (&gt;200k cells)</span></span>
<span><span class="va">large_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clust_opt.html">clust_opt</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">large_seurat</span>,</span>
<span>  sketch_size <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  on_disk <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">summary_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sil_summary.html">sil_summary</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_sil_plots.html">create_sil_plots</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="key-parameters">Key Parameters<a class="anchor" aria-label="anchor" href="#key-parameters"></a>
</h2>
<ul>
<li>
<code>subject_ids</code>: Metadata column with subject identifiers (≥3 subjects, ≥50 cells each)</li>
<li>
<code>ndim</code>: Principal components to use (30-50 for scRNA-seq, 20-30 for CyTOF)</li>
<li>
<code>dtype</code>: Data type - <code>"scRNA"</code> or <code>"CyTOF"</code> (assumes arcsinh normalized values in the counts layer)</li>
<li>
<code>sketch_size</code>: Cells for sketching large datasets (auto: 10% if &gt;200k cells)</li>
<li>
<code>within_batch</code>: Batch column for within-batch cross-validation</li>
<li>
<code>on_disk</code>: Use BPCells for memory efficiency</li>
</ul>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<p><strong>“fewer than 3 samples” error</strong>: Check <code>table(seurat_obj@meta.data$your_subject_column)</code> - ensure ≥3 subjects with ≥50 cells each</p>
<p><strong>Memory issues</strong>: Use <code>sketch_size = 10000</code> and <code>on_disk = TRUE</code></p>
<p><strong>Slow performance</strong>: Reduce <code>num_trees</code>,<code>res_range</code>, or sketch to a smaller size - too few cells will lead to a flat silhouette score curve</p>
<p><strong>Requirements</strong>: R ≥ 4.4.0, Seurat (&gt;= 5.3.0), install BPCells for large datasets</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<pre><code>Gill N, Shin MG, Agrawal A, Thomas R (2024). clustOpt: Objective optimization
of clustering resolution parameters in single-cell and mass cytometry data.
R package version 0.9. https://github.com/gladstone-institutes/clustOpt</code></pre>
</div>
<div class="section level2">
<h2 id="support">Support<a class="anchor" aria-label="anchor" href="#support"></a>
</h2>
<ul>
<li>Documentation: <code><a href="reference/clust_opt.html">?clust_opt</a></code><br>
</li>
<li>Issues: <a href="https://github.com/gladstone-institutes/clustOpt/issues" class="external-link">GitHub Issues</a>
</li>
<li>License: MIT</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/gladstone-institutes/clustOpt/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/gladstone-institutes/clustOpt/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing clustOpt</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Natalie Gill <br><small class="roles"> Author, maintainer </small>  </li>
<li>Reuben Thomas <br><small class="roles"> Author </small>  </li>
<li>Min-Gyoung Shin <br><small class="roles"> Author </small>  </li>
<li>Ayushi Agrawal <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natalie Gill, Reuben Thomas, Min-Gyoung Shin, Ayushi Agrawal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
